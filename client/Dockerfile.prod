# official base image
FROM node:18-alpine as app-frontend

USER node

# set work directory
RUN mkdir -p /home/node/build
WORKDIR /home/node

# set environment variables
ENV PATH $HOME/node_modules/.bin:$PATH

# copy files
COPY --chown=node:node package*.json .
RUN npm ci --production
COPY --chown=node:node . .

# nginx topping
RUN npm run build

FROM nginx:latest

COPY --from=app-frontend /home/node/build/ /var/www/frontend
